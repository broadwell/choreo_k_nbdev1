---

title: analyze


keywords: fastai
sidebar: home_sidebar

summary: "Tools for computing movement/pose similarity time series, clustering for single- and multi-dancer videos"
description: "Tools for computing movement/pose similarity time series, clustering for single- and multi-dancer videos"
nb_path: "04_analyze.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 04_analyze.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="smooth_series" class="doc_header"><code>smooth_series</code><a href="https://github.com/broadwell/choreo_k/tree/main/choreo_k/analyze.py#L26" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>smooth_series</code>(<strong><code>x</code></strong>, <strong><code>window_len</code></strong>=<em><code>11</code></em>, <strong><code>window</code></strong>=<em><code>'flat'</code></em>)</p>
</blockquote>
<p>Smooth a time series via a sliding window average
From <a href="https://scipy-cookbook.readthedocs.io/items/SignalSmooth.html">https://scipy-cookbook.readthedocs.io/items/SignalSmooth.html</a>
Generally used as a helper function to process_time_series() below.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="corr_time_series_matrix" class="doc_header"><code>corr_time_series_matrix</code><a href="https://github.com/broadwell/choreo_k/tree/main/choreo_k/analyze.py#L59" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>corr_time_series_matrix</code>(<strong><code>pose_data</code></strong>, <strong><code>method</code></strong>=<em><code>'distance'</code></em>)</p>
</blockquote>
<p>Generate a full time-series pose similarity heatmap for all available
poses and frames from the video. This code can use either pose
characterization approach; in practice, the distance matrix-based analyses
take longer to calculate but are more accurate.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fill_nans_scipy1" class="doc_header"><code>fill_nans_scipy1</code><a href="https://github.com/broadwell/choreo_k/tree/main/choreo_k/analyze.py#L98" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fill_nans_scipy1</code>(<strong><code>padata</code></strong>, <strong><code>pkind</code></strong>=<em><code>'linear'</code></em>)</p>
</blockquote>
<p>Fill in missing values from a time series, after the first non-NAN value
and up to the last non-NAN value. Note that scipy.interpolated.interp1d
provides a lot more options (splines, quadratic, etc.)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="movements_time_series" class="doc_header"><code>movements_time_series</code><a href="https://github.com/broadwell/choreo_k/tree/main/choreo_k/analyze.py#L123" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>movements_time_series</code>(<strong><code>pose_data</code></strong>, <strong><code>pose_index</code></strong>=<em><code>-1</code></em>, <strong><code>method</code></strong>=<em><code>'distance'</code></em>, <strong><code>figure_type</code></strong>=<em><code>'flipped_figures'</code></em>, <strong><code>video_file</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Calculate a time series of the differences between each pair of poses in a
sequence. This works with a single figure (pose_index=0) or all the figures
in the video (pose_index=-1). It can be run on its own, but typically this is
a helper function for process_movement_series() (below).</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="process_movement_series" class="doc_header"><code>process_movement_series</code><a href="https://github.com/broadwell/choreo_k/tree/main/choreo_k/analyze.py#L183" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>process_movement_series</code>(<strong><code>pose_data</code></strong>, <strong><code>pose_index</code></strong>=<em><code>-1</code></em>, <strong><code>figure_type</code></strong>=<em><code>'flipped_figures'</code></em>, <strong><code>video_file</code></strong>=<em><code>None</code></em>, <strong><code>method</code></strong>=<em><code>'distance'</code></em>, <strong><code>interpolate</code></strong>=<em><code>True</code></em>, <strong><code>viz</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>Smooth, summarize, visualize movement data for one or more figures across a
time series.
Also visualize aggregate movement data for each keypoint, if distance matrix
method is used.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="average_poses" class="doc_header"><code>average_poses</code><a href="https://github.com/broadwell/choreo_k/tree/main/choreo_k/analyze.py#L270" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>average_poses</code>(<strong><code>pose_series</code></strong>, <strong><code>descriptors</code></strong>, <strong><code>source_figures</code></strong>=<em><code>'zeroified_figures'</code></em>, <strong><code>flip</code></strong>=<em><code>True</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_feature_vectors" class="doc_header"><code>get_feature_vectors</code><a href="https://github.com/broadwell/choreo_k/tree/main/choreo_k/analyze.py#L287" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_feature_vectors</code>(<strong><code>pose_series</code></strong>, <strong><code>figure_type</code></strong>=<em><code>'aligned_figures'</code></em>, <strong><code>method</code></strong>=<em><code>'distance'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cluster_poses" class="doc_header"><code>cluster_poses</code><a href="https://github.com/broadwell/choreo_k/tree/main/choreo_k/analyze.py#L303" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cluster_poses</code>(<strong><code>poses_series</code></strong>, <strong><code>figure_type</code></strong>=<em><code>'aligned_figures'</code></em>, <strong><code>min_samples</code></strong>=<em><code>50</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_cluster_averages_and_indices" class="doc_header"><code>get_cluster_averages_and_indices</code><a href="https://github.com/broadwell/choreo_k/tree/main/choreo_k/analyze.py#L319" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_cluster_averages_and_indices</code>(<strong><code>labels</code></strong>, <strong><code>descriptors</code></strong>, <strong><code>pose_series</code></strong>, <strong><code>figure_type</code></strong>=<em><code>'figures'</code></em>, <strong><code>video_file</code></strong>=<em><code>None</code></em>, <strong><code>flip_figures</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Average the members of each pose cluster to get the representative "average"
pose for the cluster.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="find_nearest_pose" class="doc_header"><code>find_nearest_pose</code><a href="https://github.com/broadwell/choreo_k/tree/main/choreo_k/analyze.py#L353" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>find_nearest_pose</code>(<strong><code>pose_matrix</code></strong>, <strong><code>cluster_averages</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="render_pose_distribution" class="doc_header"><code>render_pose_distribution</code><a href="https://github.com/broadwell/choreo_k/tree/main/choreo_k/analyze.py#L367" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>render_pose_distribution</code>(<strong><code>heatmap</code></strong>, <strong><code>poses_series</code></strong>, <strong><code>labels</code></strong>, <strong><code>descriptors</code></strong>, <strong><code>closest_matches</code></strong>=<em><code>None</code></em>, <strong><code>show</code></strong>=<em><code>True</code></em>, <strong><code>video_file</code></strong>=<em><code>None</code></em>, <strong><code>time_index</code></strong>=<em><code>None</code></em>, <strong><code>cell_height</code></strong>=<em><code>120</code></em>, <strong><code>xlim</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Draw a pose cluster timeline based on a precomputed clustering and
assigment of non-clustered poses to clusters via compute_pose_distribution()
below. Passing in the heatmap from the previous step saves a lot of time.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="compute_pose_distribution" class="doc_header"><code>compute_pose_distribution</code><a href="https://github.com/broadwell/choreo_k/tree/main/choreo_k/analyze.py#L424" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>compute_pose_distribution</code>(<strong><code>poses_series</code></strong>, <strong><code>labels</code></strong>, <strong><code>descriptors</code></strong>, <strong><code>figure_type</code></strong>=<em><code>'zeroified_figures'</code></em>, <strong><code>cluster_averages</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Assign non-clustered poses to clusters (can take a long time) and generate
a clustering timeline heatmap of the pose occurrences.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="condense_labels" class="doc_header"><code>condense_labels</code><a href="https://github.com/broadwell/choreo_k/tree/main/choreo_k/analyze.py#L462" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>condense_labels</code>(<strong><code>labels</code></strong>, <strong><code>cluster_map</code></strong>)</p>
</blockquote>
<p>Can be used to "collapse" clusters of similar poses into meta-clusters</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="compare_multiple" class="doc_header"><code>compare_multiple</code><a href="https://github.com/broadwell/choreo_k/tree/main/choreo_k/analyze.py#L474" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>compare_multiple</code>(<strong><code>pose_data</code></strong>, <strong><code>method</code></strong>=<em><code>'distance'</code></em>, <strong><code>figure_type</code></strong>=<em><code>'aligned_figures'</code></em>)</p>
</blockquote>
<p>For multi-dancer videos: Get the mean and standard deviation of inter-pose
similarities for each frame</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="plot_interpose_similarity" class="doc_header"><code>plot_interpose_similarity</code><a href="https://github.com/broadwell/choreo_k/tree/main/choreo_k/analyze.py#L508" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>plot_interpose_similarity</code>(<strong><code>pose_series</code></strong>, <strong><code>frame_means</code></strong>, <strong><code>frame_stdevs</code></strong>, <strong><code>video_file</code></strong>, <strong><code>show</code></strong>=<em><code>False</code></em>, <strong><code>min_clip</code></strong>=<em><code>0.2</code></em>)</p>
</blockquote>
<p>For multi-pose videos</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="average_frame_movements" class="doc_header"><code>average_frame_movements</code><a href="https://github.com/broadwell/choreo_k/tree/main/choreo_k/analyze.py#L552" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>average_frame_movements</code>(<strong><code>movement_series</code></strong>, <strong><code>poses_series</code></strong>, <strong><code>show</code></strong>=<em><code>False</code></em>, <strong><code>max_clip</code></strong>=<em><code>3</code></em>, <strong><code>video_file</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Compute the average and stdv of the inter-frame movement for each frame of a
pose sequence with &gt;= 1 dancers.
Assumes movement_series is an array of inter-frame movement values, one for each
detected pose, with missing poses identified via np.nan, as generated from
process_movement_series.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="member_frame_movements" class="doc_header"><code>member_frame_movements</code><a href="https://github.com/broadwell/choreo_k/tree/main/choreo_k/analyze.py#L609" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>member_frame_movements</code>(<strong><code>movement_series</code></strong>, <strong><code>poses_series</code></strong>, <strong><code>max_clip</code></strong>=<em><code>3</code></em>, <strong><code>show</code></strong>=<em><code>False</code></em>, <strong><code>condense</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>For a multi-dancer video, generate individual inter-frame movement series
for all of the dancers and plot them.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

